<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Goling</title>

    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="GOLING (Go Healing)" />
    <meta name="keywords" content="goling team" />

    <!-- Icon -->
    <link rel="icon" href="./images/goling.ico" />

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Symbols -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/boxicons@latest/css/boxicons.min.css"
    />
  </head>

  <body>
    <!-- Header -->
    <header>
      <div id="navbarId" class="navbar">
        <div class="headerInner">
          <h1 class="headerTitle">Goling</h1>
          <ul class="navigationResponsive">
            <li>
              <button
                id="navigationDrawerId"
                class="navigationDrawer"
                aria-label="Open navigation drawer"
              >
                ☰
              </button>
            </li>
          </ul>
        </div>
        <nav id="navbarContainerId" class="navbarContainer">
          <ul class="navbarList">
            <li class="navbarItem"><a href="./index.html">Home</a></li>
            <li class="navbarItem">
              <a href="./index.html#destinations">Destination</a>
            </li>
            <li class="navbarItem">
              <a href="./index.html#contact">Contact</a>
            </li>
            <li class="navbarItem"><a href="./about.html">About Us</a></li>
            <li class="navbarItem">
              <a href="https://forms.gle/Nzrm56hTmn1uAxLc9">Add Destination</a>
            </li>
            <li class="navbarItem">
              <button id="myBooking">My Booking</button>
            </li>
          </ul>
        </nav>
      </div>
      <div class="hero">
        <div class="heroContainer">
          <h1 class="heroTitle">
            Explore all of Indonesia and enjoy its beauty
          </h1>
          <p class="heroDescription">Find the tour you want here.</p>
        </div>
      </div>
    </header>

    <!-- Booking Form -->
    <div class="booking-container">
      <h1>Booking Form</h1>
      <form id="bookingForm" onsubmit="return validateForm()">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required />

        <label for="phone">Phone Number:</label>
        <input type="tel" id="phone" name="phone" pattern="[0-9]*" required />

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required />
        <div class="ticket-card-container">
          <div class="ticket-card-form">
            <div class="orang">
              <h2>Dewasa</h2>
            </div>
            <div class="ticket-qty-form">
              <div class="ticket-price-form">
                <h2><span>RP 35.000</span>/Orang</h2>
              </div>
              <div class="ticket-qtynumber-form">
                <p id="dewasa-minus">
                  <svg
                    width="40"
                    height="40"
                    viewBox="0 0 40 40"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle
                      cx="20"
                      cy="20"
                      r="19.75"
                      stroke="black"
                      stroke-width="0.5"
                    />
                    <path
                      d="M24.3586 18.28V20.128H14.7826V18.28H24.3586Z"
                      fill="black"
                    />
                  </svg>
                </p>
                <h1 id="dewasaValue">0</h1>
                <p id="dewasa-plus">
                  <svg
                    width="40"
                    height="40"
                    viewBox="0 0 40 40"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle
                      cx="20"
                      cy="20"
                      r="19.75"
                      stroke="black"
                      stroke-width="0.5"
                    />
                    <path
                      d="M25.6366 20.152H20.5246V25.336H18.4846V20.152H13.3966V18.304H18.4846V13.096H20.5246V18.304H25.6366V20.152Z"
                      fill="black"
                    />
                  </svg>
                </p>
              </div>
            </div>
          </div>
          <div class="ticket-card-form">
            <div class="orang">
              <h2>Anak</h2>
            </div>
            <div class="ticket-qty-form">
              <div class="ticket-price-form">
                <h2><span>RP 30.000</span>/Orang</h2>
              </div>
              <div class="ticket-qtynumber-form">
                <p id="anak-minus">
                  <svg
                    width="40"
                    height="40"
                    viewBox="0 0 40 40"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle
                      cx="20"
                      cy="20"
                      r="19.75"
                      stroke="black"
                      stroke-width="0.5"
                    />
                    <path
                      d="M24.3586 18.28V20.128H14.7826V18.28H24.3586Z"
                      fill="black"
                    />
                  </svg>
                </p>
                <h1 id="anakValue">0</h1>
                <p id="anak-plus">
                  <svg
                    width="40"
                    height="40"
                    viewBox="0 0 40 40"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle
                      cx="20"
                      cy="20"
                      r="19.75"
                      stroke="black"
                      stroke-width="0.5"
                    />
                    <path
                      d="M25.6366 20.152H20.5246V25.336H18.4846V20.152H13.3966V18.304H18.4846V13.096H20.5246V18.304H25.6366V20.152Z"
                      fill="black"
                    />
                  </svg>
                </p>
              </div>
            </div>
          </div>
        </div>
        <label for="date">Date:</label>
        <input type="datetime-local" id="date" name="date" required />

        <button class="submitBooking" type="submit" id="myBtn">Submit</button>
      </form>
    </div>

    <!-- Wave on Footer -->
    <section class="wave">
      <div class="air air1"></div>
      <div class="air air2"></div>
      <div class="air air3"></div>
      <div class="air air4"></div>
    </section>

    <!-- Footer -->
    <footer id="contact">
      <div class="foot">
        <div class="footer-content">
          <div class="footlinks">
            <h4>Top Destination</h4>
            <ul>
              <li class="top">Denpasar, Bali</li>
              <li class="top">Cimahi, Jawa Barat</li>
              <li class="top">Bandung, Jawa Barat</li>
              <li class="top">Medan, Sumatera</li>
              <li class="top">Jakarta Selatan, Jakarta</li>
            </ul>
          </div>

          <div class="footlinks">
            <h4>Quick Links</h4>
            <ul>
              <li><a href="./index.html">Home</a></li>
              <li><a href="./index.html#destinations">Destination</a></li>
              <li><a href="./index.html#contact">Contact</a></li>
              <li><a href="./about.html">About Us</a></li>
              <li>
                <a href="https://forms.gle/Nzrm56hTmn1uAxLc9"
                  >Add Destination</a
                >
              </li>
            </ul>
          </div>

          <div class="footlinks">
            <h4>Contact</h4>
            <ul>
              <li class="contact-item">
                <a href="#" class="contact-link">Admin : +62 111-222-333</a>
              </li>
              <li class="contact-item">
                <a href="#" class="contact-link">Email : goling@gmail.com</a>
              </li>
              <li class="contact-item">
                <address>Bandung, Jawa Barat</address>
              </li>
            </ul>
          </div>

          <div class="footlinks">
            <h4>Social Media</h4>
            <div class="social">
              <a href="#" target="_blank"><i class="bx bxl-whatsapp"></i></a>
              <a href="#" target="_blank"><i class="bx bxl-facebook"></i></a>
              <a href="#" target="_blank"><i class="bx bxl-instagram"></i></a>
              <a href="#" target="_blank"><i class="bx bxl-twitter"></i></a>
              <a href="#" target="_blank"><i class="bx bxl-youtube"></i></a>
            </div>
          </div>
        </div>
      </div>

      <div class="end">
        <p>GOLING © 2024 All Rights Reserved</p>
      </div>
    </footer>

    <div id="myModal" class="modal hidden">
      <div class="modal-content">
        <div id="bookingInfo">
          <div class="modal-header">
            <h2>Booking Information</h2>
            <span id="close">
              <?xml version="1.0" encoding="utf-8"?>
              <svg
                fill="#000000"
                width="28px"
                height="28px"
                viewBox="0 -0.01 512.023 512.023"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g
                  id="_18_Close"
                  data-name="18 Close"
                  transform="translate(0.012 0.001)"
                >
                  <path
                    id="Path_25"
                    data-name="Path 25"
                    d="M74.966,437.013C-25,337.043-25,174.947,74.966,74.976c100-99.97,262.067-99.97,362.068,0,99.97,99.971,99.97,262.067,0,362.037C337.033,537,174.968,537,74.966,437.013ZM391.783,120.227c-75-74.985-196.565-74.985-271.535,0-75,74.985-75,196.55,0,271.535,74.97,74.986,196.534,74.986,271.535,0C466.754,316.776,466.754,195.212,391.783,120.227ZM188.124,369.137l-45.251-45.266,67.876-67.877-67.876-67.876,45.251-45.267L256,210.724l67.876-67.873,45.252,45.267-67.877,67.876,67.877,67.877L323.876,369.137,256,301.261ZM281.021,256,356.1,180.917,331.106,155.93,256,230.98,180.921,155.93l-25,25L230.99,256,155.919,331.08l25,25,75.06-75.074,75.074,75.074,25.005-25.011Z"
                    transform="translate(0 0)"
                  />
                </g>
              </svg>
            </span>
          </div>
          <div class="modal-body">
            <p id="nameInfo"></p>
            <p id="phoneInfo"></p>
            <p id="emailInfo"></p>
            <p id="dateInfo"></p>
            <p id="adultInfo"></p>
            <p id="childInfo"></p>
            <button
              type="submit"
              id="bookingButton"
              onclick="redirectToPayment()"
            >
              Booking Now
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      var apiUrl = "";
      if (window.location.hostname === "localhost") {
        apiUrl = "http://localhost:8001";
      } else {
        apiUrl = "https://api.goling.site";
      }
      function validateForm() {
        var name = document.getElementById("name").value;
        var phone = document.getElementById("phone").value;
        var email = document.getElementById("email").value;
        var date = document.getElementById("date").value;

        if (name === "" || phone === "" || email === "" || date === "") {
          alert("Please fill in all fields.");
          return false;
        }
        return true;
      }

      var dewasaValue = 0;
      var anakValue = 0;
      var id = "";
      document
        .getElementById("dewasa-plus")
        .addEventListener("click", function () {
          var dewasaValueElement = document.getElementById("dewasaValue");
          dewasaValueElement.textContent =
            parseInt(dewasaValueElement.textContent) + 1;
        });

      document
        .getElementById("dewasa-minus")
        .addEventListener("click", function () {
          var dewasaValueElement = document.getElementById("dewasaValue");
          var currentValue = parseInt(dewasaValueElement.textContent);
          if (currentValue > 0) {
            dewasaValueElement.textContent = currentValue - 1;
          }
        });

      document
        .getElementById("anak-plus")
        .addEventListener("click", function () {
          var anakValueElement = document.getElementById("anakValue");
          anakValueElement.textContent =
            parseInt(anakValueElement.textContent) + 1;
        });

      document
        .getElementById("anak-minus")
        .addEventListener("click", function () {
          var anakValueElement = document.getElementById("anakValue");
          var currentValue = parseInt(anakValueElement.textContent);
          if (currentValue > 0) {
            anakValueElement.textContent = currentValue - 1;
          }
        });

      var modal = document.getElementById("myModal");

      var btn = document.getElementById("myBtn");

      var span = document.getElementById("close");

      btn.onclick = function () {
        event.preventDefault();
        if (!validateForm()) {
          return;
        }
        modal.style.display = "block";

        document.getElementById("nameInfo").textContent =
          "Name: " + document.getElementById("name").value;
        document.getElementById("phoneInfo").textContent =
          "Phone: " + document.getElementById("phone").value;
        document.getElementById("emailInfo").textContent =
          "Email: " + document.getElementById("email").value;
        document.getElementById("dateInfo").textContent =
          "Date: " + document.getElementById("date").value;
        var ticketInfo = "";
        var dewasaValue = parseInt(
          document.getElementById("dewasaValue").textContent
        );
        var anakValue = parseInt(
          document.getElementById("anakValue").textContent
        );

        if (dewasaValue > 0) {
          ticketInfo += dewasaValue + " Dewasa";
        }

        if (anakValue > 0) {
          if (ticketInfo !== "") {
            ticketInfo += ", ";
          }
          ticketInfo += anakValue + " Anak";
        }

        document.getElementById("adultInfo").textContent =
          "Tiket : " + ticketInfo;
      };

      span.onclick = function () {
        modal.style.display = "none";
      };

      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };
      function redirectToPayment() {
        $.ajax({
          url: `${apiUrl}/transactions`,
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify({
            name: document.getElementById("name").value,
            phone: document.getElementById("phone").value,
            email: document.getElementById("email").value,
            ticket_qty: parseInt(dewasaValue) + parseInt(anakValue),
            date_booking: document.getElementById("date").value,
            destination_id: id,
          }),

          success: function (response) {
            saveTransactionId(response.id, response.snap_url);
            window.location.href = "/payment.html?id=" + response.id;
          },
          error: function (error) {
            let timerInterval;
            Swal.fire({
              title: "Oops...",
              icon: "error",
              html: "Transaksi Failed!",
              timer: 2000,
              willClose: () => {
                clearInterval(timerInterval);
              },
            });
            return;
          },
        });
      }

      function saveTransactionId(transactionId, snapUrl) {
        var db;
        var request = indexedDB.open("transactions_db", 1);

        request.onerror = function (event) {
          console.error("Database error:", event.target.errorCode);
        };

        request.onsuccess = function (event) {
          db = event.target.result;
          var transaction = db.transaction(["transactions"], "readwrite");
          var objectStore = transaction.objectStore("transactions");
          var request = objectStore.add({
            id: transactionId,
            snap_url: snapUrl,
          });

          request.onsuccess = function (event) {
            console.log("Transaction ID and Snap URL saved in database.");
            db.close();
          };

          request.onerror = function (event) {
            console.error(
              "Failed to save transaction ID and Snap URL:",
              event.target.errorCode
            );
          };
        };

        request.onupgradeneeded = function (event) {
          db = event.target.result;
          var objectStore = db.createObjectStore("transactions", {
            keyPath: "id",
          });
          console.log("Database setup complete.");
        };
      }

      document.addEventListener("DOMContentLoaded", () => {
        var param = new URLSearchParams(window.location.search);
        id = param.get("id");
        dewasaValue = param.get("dewasa");
        anakValue = param.get("anak");
        var dewasa = document.getElementById("dewasaValue");
        var anak = document.getElementById("anakValue");
        if (!id) {
          window.location.href = "/";
        }
        if (dewasaValue) {
          dewasa.textContent = dewasaValue;
        }
        if (anakValue) {
          anak.textContent = anakValue;
        }
      });
    </script>
  </body>
</html>
